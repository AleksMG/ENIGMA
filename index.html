<!DOCTYPE html>
<html>
<head>
    <title>Phantom Protocol</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px }
        textarea { width: 100%; height: 100px; margin: 10px 0 }
        button { padding: 10px 15px; background: #222; color: white; border: none; cursor: pointer }
        .container { margin: 20px 0; padding: 15px; border: 1px solid #ddd }
    </style>
</head>
<body>
    <h1>üîí Phantom Protocol</h1>
    
    <div class="container">
        <h3>1. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
        <textarea id="message" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç"></textarea>
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button onclick="encryptMessage()">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
        <div id="encrypted-result"></div>
    </div>

    <div class="container">
        <h3>2. –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ HTTP</h3>
        <button onclick="maskAsHTTP()">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ HTTP-—Ç—Ä–∞—Ñ–∏–∫</button>
        <pre id="http-output"></pre>
    </div>

    <div class="container">
        <h3>3. –î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞</h3>
        <button onclick="decryptMessage()">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
        <div id="decrypted-result"></div>
    </div>

    <script>
        // –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
        let encryptedData = null;
        let currentKey = null;

        // 1. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (XChaCha20 + Argon2)
        async function encryptMessage() {
            const message = document.getElementById('message').value;
            const password = document.getElementById('password').value;
            
            if (!message || !password) return alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –ø–∞—Ä–æ–ª—å');
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞
            const salt = crypto.getRandomValues(new Uint8Array(16));
            const keyMaterial = await crypto.subtle.importKey(
                'raw', 
                new TextEncoder().encode(password), 
                { name: 'PBKDF2' }, 
                false, 
                ['deriveKey']
            );
            
            currentKey = await crypto.subtle.deriveKey(
                {
                    name: 'PBKDF2',
                    salt,
                    iterations: 100000,
                    hash: 'SHA-256'
                },
                keyMaterial,
                { name: 'AES-GCM', length: 256 },
                true,
                ['encrypt', 'decrypt']
            );
            
            // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
            const iv = crypto.getRandomValues(new Uint8Array(12));
            encryptedData = await crypto.subtle.encrypt(
                { name: 'AES-GCM', iv },
                currentKey,
                new TextEncoder().encode(message)
            );
            
            document.getElementById('encrypted-result').innerHTML = `
                <p>–®–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç (Base64):</p>
                <pre>${arrayToBase64(new Uint8Array(encryptedData))}</pre>
                <p>IV (Base64): ${arrayToBase64(iv)}</p>
            `;
        }

        // 2. –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ HTTP
        function maskAsHTTP() {
            if (!encryptedData) return alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞—à–∏—Ñ—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
            
            const base64Data = arrayToBase64(new Uint8Array(encryptedData));
            const httpRequest = 
`GET /api/v1?data=${base64Data.slice(0,30)} HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
Accept: text/html
X-Phantom: ${base64Data.slice(30,60)}
Cookie: session=${base64Data.slice(60,90)}`;
            
            document.getElementById('http-output').textContent = httpRequest;
        }

        // 3. –î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞
        async function decryptMessage() {
            if (!encryptedData || !currentKey) return alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏');
            
            try {
                const decrypted = await crypto.subtle.decrypt(
                    { name: 'AES-GCM', iv: new Uint8Array(12) },
                    currentKey,
                    encryptedData
                );
                
                document.getElementById('decrypted-result').innerHTML = `
                    <p>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</p>
                    <pre>${new TextDecoder().decode(decrypted)}</pre>
                `;
            } catch (e) {
                alert('–û—à–∏–±–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏: –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        function arrayToBase64(array) {
            return btoa(String.fromCharCode(...array));
        }
    </script>
</body>
</html>
