<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enigma-style Decryptor</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #1a1a1a;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            color: #4fc3f7;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }
        
        .control-panel {
            background-color: #333;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #81c784;
        }
        
        input[type="text"], 
        input[type="number"], 
        textarea {
            width: 100%;
            padding: 8px;
            background-color: #222;
            border: 1px solid #444;
            color: #e0e0e0;
            border-radius: 4px;
            font-family: 'Roboto Mono', monospace;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .settings-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .setting {
            flex: 1;
        }
        
        input[type="range"] {
            width: 100%;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            padding: 10px 15px;
            background-color: #1976d2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Roboto Mono', monospace;
            flex: 1;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #1565c0;
        }
        
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        
        #stopBtn {
            background-color: #d32f2f;
        }
        
        #stopBtn:hover {
            background-color: #b71c1c;
        }
        
        #shuffleBtn, #resetBtn {
            background-color: #7b1fa2;
        }
        
        #shuffleBtn:hover, #resetBtn:hover {
            background-color: #6a1b9a;
        }
        
        .results {
            background-color: #333;
            padding: 20px;
            border-radius: 6px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat {
            background-color: #222;
            padding: 10px;
            border-radius: 4px;
        }
        
        .stat span:first-child {
            color: #81c784;
            display: block;
            font-size: 0.9em;
        }
        
        .stat span:last-child {
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .progress-container {
            background-color: #222;
            height: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #4fc3f7;
            width: 0%;
            transition: width 0.3s;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .results-column h3 {
            color: #4fc3f7;
            margin-top: 0;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
        }
        
        .results-box {
            background-color: #222;
            padding: 15px;
            border-radius: 4px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .decrypted-text {
            font-size: 1.2em;
            letter-spacing: 1px;
        }
        
        .rotor-config {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .rotor {
            background-color: #222;
            padding: 15px;
            border-radius: 4px;
        }
        
        .rotor h4 {
            margin-top: 0;
            color: #81c784;
            text-align: center;
        }
        
        .rotor-settings {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .plugboard {
            background-color: #222;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .plugboard h4 {
            margin-top: 0;
            color: #81c784;
        }
        
        .plugboard-pairs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .plugboard-pair {
            display: flex;
            align-items: center;
        }
        
        .plugboard-pair input {
            width: 30px;
            text-align: center;
            text-transform: uppercase;
        }
        
        @media (max-width: 768px) {
            .settings-row, .results-grid, .rotor-config {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Enigma-style Decryptor</h1>
        
        <div class="control-panel">
            <div class="input-group">
                <label for="ciphertext">Ciphertext:</label>
                <textarea id="ciphertext" rows="4" spellcheck="false">OBKRUOXOGHULBSOLIFBBWFLRVQQPRNGKSSOTWTQSJQSSEKZZWATJKLUDIAWINFBNYPVTTMZFPKWGDKZXTJCDIGKUHUAUEKCAR</textarea>
            </div>

            <div class="input-group">
                <label for="knownPlaintext">Known Plaintext Fragment:</label>
                <input type="text" id="knownPlaintext" placeholder="e.g. BERLIN" spellcheck="false">
            </div>

            <div class="rotor-config">
                <div class="rotor">
                    <h4>Rotor I</h4>
                    <div class="rotor-settings">
                        <div>
                            <label for="rotor1Type">Type:</label>
                            <select id="rotor1Type" class="rotor-type">
                                <option value="I">I (EKMFLGDQVZNTOWYHXUSPAIBRCJ)</option>
                                <option value="II">II (AJDKSIRUXBLHWTMCQGZNPYFVOE)</option>
                                <option value="III">III (BDFHJLCPRTXVZNYEIWGAKMUSQO)</option>
                                <option value="IV">IV (ESOVPZJAYQUIRHXLNFTGKDCMWB)</option>
                                <option value="V">V (VZBRGITYUPSDNHLXAWMJQOFECK)</option>
                            </select>
                        </div>
                        <div>
                            <label for="rotor1Pos">Position:</label>
                            <input type="text" id="rotor1Pos" value="A" maxlength="1" class="rotor-pos">
                        </div>
                        <div>
                            <label for="rotor1Ring">Ring Setting:</label>
                            <input type="text" id="rotor1Ring" value="A" maxlength="1" class="rotor-ring">
                        </div>
                    </div>
                </div>
                
                <div class="rotor">
                    <h4>Rotor II</h4>
                    <div class="rotor-settings">
                        <div>
                            <label for="rotor2Type">Type:</label>
                            <select id="rotor2Type" class="rotor-type">
                                <option value="I">I (EKMFLGDQVZNTOWYHXUSPAIBRCJ)</option>
                                <option value="II" selected>II (AJDKSIRUXBLHWTMCQGZNPYFVOE)</option>
                                <option value="III">III (BDFHJLCPRTXVZNYEIWGAKMUSQO)</option>
                                <option value="IV">IV (ESOVPZJAYQUIRHXLNFTGKDCMWB)</option>
                                <option value="V">V (VZBRGITYUPSDNHLXAWMJQOFECK)</option>
                            </select>
                        </div>
                        <div>
                            <label for="rotor2Pos">Position:</label>
                            <input type="text" id="rotor2Pos" value="A" maxlength="1" class="rotor-pos">
                        </div>
                        <div>
                            <label for="rotor2Ring">Ring Setting:</label>
                            <input type="text" id="rotor2Ring" value="A" maxlength="1" class="rotor-ring">
                        </div>
                    </div>
                </div>
                
                <div class="rotor">
                    <h4>Rotor III</h4>
                    <div class="rotor-settings">
                        <div>
                            <label for="rotor3Type">Type:</label>
                            <select id="rotor3Type" class="rotor-type">
                                <option value="I">I (EKMFLGDQVZNTOWYHXUSPAIBRCJ)</option>
                                <option value="II">II (AJDKSIRUXBLHWTMCQGZNPYFVOE)</option>
                                <option value="III" selected>III (BDFHJLCPRTXVZNYEIWGAKMUSQO)</option>
                                <option value="IV">IV (ESOVPZJAYQUIRHXLNFTGKDCMWB)</option>
                                <option value="V">V (VZBRGITYUPSDNHLXAWMJQOFECK)</option>
                            </select>
                        </div>
                        <div>
                            <label for="rotor3Pos">Position:</label>
                            <input type="text" id="rotor3Pos" value="A" maxlength="1" class="rotor-pos">
                        </div>
                        <div>
                            <label for="rotor3Ring">Ring Setting:</label>
                            <input type="text" id="rotor3Ring" value="A" maxlength="1" class="rotor-ring">
                        </div>
                    </div>
                </div>
            </div>

            <div class="plugboard">
                <h4>Plugboard Settings</h4>
                <div class="plugboard-pairs">
                    <div class="plugboard-pair">
                        <input type="text" class="plugboard-input" maxlength="1">
                        <span> ↔ </span>
                        <input type="text" class="plugboard-input" maxlength="1">
                    </div>
                    <!-- More pairs can be added here or dynamically -->
                </div>
            </div>

            <div class="settings-row">
                <div class="setting">
                    <label for="reflector">Reflector:</label>
                    <select id="reflector">
                        <option value="B">B (YRUHQSLDPXNGOKMIEBFZCWVJAT)</option>
                        <option value="C">C (FVPJIAOYEDRZXWGCTKUQSBNMHL)</option>
                    </select>
                </div>
                <div class="setting">
                    <label for="workers">Workers:</label>
                    <input type="range" id="workers" min="1" max="16" value="4">
                    <span id="workersValue">4</span>
                </div>
            </div>

            <div class="buttons">
                <button id="startBtn">Start Attack</button>
                <button id="stopBtn" disabled>Stop</button>
                <button id="randomBtn">Random Settings</button>
                <button id="resetBtn">Reset Settings</button>
            </div>
        </div>

        <div class="results">
            <div class="stats-grid">
                <div class="stat">
                    <span>Time Elapsed:</span>
                    <span id="elapsed">0s</span>
                </div>
                <div class="stat">
                    <span>Configurations Tested:</span>
                    <span id="configsTested">0</span> / <span id="totalConfigs">0</span>
                </div>
                <div class="stat">
                    <span>Configs/sec:</span>
                    <span id="configsPerSec">0</span>
                </div>
                <div class="stat">
                    <span>Best Score:</span>
                    <span id="bestScore">0</span>
                </div>
                <div class="stat">
                    <span>Completion:</span>
                    <span id="completion">0%</span>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="results-grid">
                <div class="results-column">
                    <h3>Top Candidates</h3>
                    <div id="topResults" class="results-box"></div>
                </div>
                <div class="results-column">
                    <h3>Decrypted Text</h3>
                    <div id="decryptedText" class="results-box decrypted-text"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enigma machine implementation
        class EnigmaMachine {
            constructor() {
                this.rotors = [
                    { wiring: "EKMFLGDQVZNTOWYHXUSPAIBRCJ", notch: "Q" },
                    { wiring: "AJDKSIRUXBLHWTMCQGZNPYFVOE", notch: "E" },
                    { wiring: "BDFHJLCPRTXVZNYEIWGAKMUSQO", notch: "V" },
                    { wiring: "ESOVPZJAYQUIRHXLNFTGKDCMWB", notch: "J" },
                    { wiring: "VZBRGITYUPSDNHLXAWMJQOFECK", notch: "Z" }
                ];
                
                this.reflectors = {
                    "B": "YRUHQSLDPXNGOKMIEBFZCWVJAT",
                    "C": "FVPJIAOYEDRZXWGCTKUQSBNMHL"
                };
                
                this.alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
                this.reset();
            }
            
            reset() {
                this.currentRotors = [
                    { type: 0, position: 0, ring: 0, wiring: "", notch: "" },
                    { type: 1, position: 0, ring: 0, wiring: "", notch: "" },
                    { type: 2, position: 0, ring: 0, wiring: "", notch: "" }
                ];
                this.reflector = "B";
                this.plugboard = {};
            }
            
            configure(rotorTypes, rotorPositions, rotorRings, reflector, plugboardPairs) {
                // Set rotors
                for (let i = 0; i < 3; i++) {
                    this.currentRotors[i].type = rotorTypes[i];
                    this.currentRotors[i].position = this.alphabet.indexOf(rotorPositions[i]);
                    this.currentRotors[i].ring = this.alphabet.indexOf(rotorRings[i]);
                    
                    const rotor = this.rotors[rotorTypes[i]];
                    this.currentRotors[i].wiring = rotor.wiring;
                    this.currentRotors[i].notch = rotor.notch;
                }
                
                // Set reflector
                this.reflector = reflector;
                
                // Set plugboard
                this.plugboard = {};
                for (const pair of plugboardPairs) {
                    if (pair[0] && pair[1] && pair[0] !== pair[1]) {
                        this.plugboard[pair[0]] = pair[1];
                        this.plugboard[pair[1]] = pair[0];
                    }
                }
            }
            
            encrypt(character) {
                // Step rotors
                this.stepRotors();
                
                // Plugboard in
                if (this.plugboard[character]) {
                    character = this.plugboard[character];
                }
                
                // Forward through rotors
                let result = character;
                for (let i = 0; i < 3; i++) {
                    const rotor = this.currentRotors[i];
                    const pos = (this.alphabet.indexOf(result) + rotor.position - rotor.ring + 26) % 26;
                    result = rotor.wiring[pos];
                    result = this.alphabet[(this.alphabet.indexOf(result) - rotor.position + rotor.ring + 26) % 26];
                }
                
                // Reflector
                result = this.reflectors[this.reflector][this.alphabet.indexOf(result)];
                
                // Backward through rotors
                for (let i = 2; i >= 0; i--) {
                    const rotor = this.currentRotors[i];
                    result = this.alphabet[(this.alphabet.indexOf(result) + rotor.position - rotor.ring + 26) % 26];
                    result = this.alphabet[(rotor.wiring.indexOf(result) - rotor.position + rotor.ring + 26) % 26];
                }
                
                // Plugboard out
                if (this.plugboard[result]) {
                    result = this.plugboard[result];
                }
                
                return result;
            }
            
            stepRotors() {
                // Check if second rotor should double-step (notch on previous step)
                let rotateR3 = false;
                let rotateR2 = this.currentRotors[1].position === this.alphabet.indexOf(this.currentRotors[1].notch);
                
                // Always rotate right rotor
                this.currentRotors[2].position = (this.currentRotors[2].position + 1) % 26;
                
                // Check if right rotor is at notch
                if (this.currentRotors[2].position === this.alphabet.indexOf(this.currentRotors[2].notch)) {
                    rotateR3 = true;
                }
                
                // Rotate middle rotor if needed
                if (rotateR3 || rotateR2) {
                    this.currentRotors[1].position = (this.currentRotors[1].position + 1) % 26;
                    
                    // Check if middle rotor is at notch (for double-stepping)
                    if (this.currentRotors[1].position === this.alphabet.indexOf(this.currentRotors[1].notch)) {
                        this.currentRotors[0].position = (this.currentRotors[0].position + 1) % 26;
                    }
                }
            }
            
            encryptString(text) {
                return text.split('').map(c => {
                    if (this.alphabet.includes(c)) {
                        return this.encrypt(c);
                    }
                    return c;
                }).join('');
            }
            
            decryptString(text) {
                // Decryption is the same as encryption in Enigma
                return this.encryptString(text);
            }
        }

        // UI and control logic
        document.addEventListener('DOMContentLoaded', function() {
            const enigma = new EnigmaMachine();
            let workers = [];
            let isRunning = false;
            let startTime = 0;
            let configsTested = 0;
            let bestScore = 0;
            let bestConfig = null;
            let bestDecrypted = "";
            let updateInterval;
            
            // UI elements
            const ciphertextEl = document.getElementById('ciphertext');
            const knownPlaintextEl = document.getElementById('knownPlaintext');
            const workersEl = document.getElementById('workers');
            const workersValueEl = document.getElementById('workersValue');
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const randomBtn = document.getElementById('randomBtn');
            const resetBtn = document.getElementById('resetBtn');
            const elapsedEl = document.getElementById('elapsed');
            const configsTestedEl = document.getElementById('configsTested');
            const totalConfigsEl = document.getElementById('totalConfigs');
            const configsPerSecEl = document.getElementById('configsPerSec');
            const bestScoreEl = document.getElementById('bestScore');
            const completionEl = document.getElementById('completion');
            const progressBarEl = document.getElementById('progressBar');
            const topResultsEl = document.getElementById('topResults');
            const decryptedTextEl = document.getElementById('decryptedText');
            
            // Rotor elements
            const rotorTypeEls = [
                document.getElementById('rotor1Type'),
                document.getElementById('rotor2Type'),
                document.getElementById('rotor3Type')
            ];
            
            const rotorPosEls = [
                document.getElementById('rotor1Pos'),
                document.getElementById('rotor2Pos'),
                document.getElementById('rotor3Pos')
            ];
            
            const rotorRingEls = [
                document.getElementById('rotor1Ring'),
                document.getElementById('rotor2Ring'),
                document.getElementById('rotor3Ring')
            ];
            
            const reflectorEl = document.getElementById('reflector');
            const plugboardInputs = document.querySelectorAll('.plugboard-input');
            
            // Event listeners
            workersEl.addEventListener('input', function() {
                workersValueEl.textContent = this.value;
            });
            
            startBtn.addEventListener('click', startAttack);
            stopBtn.addEventListener('click', stopAttack);
            randomBtn.addEventListener('click', randomizeSettings);
            resetBtn.addEventListener('click', resetSettings);
            
            // Validate rotor positions and rings
            rotorPosEls.forEach(el => {
                el.addEventListener('input', function() {
                    this.value = this.value.toUpperCase().replace(/[^A-Z]/g, '');
                });
            });
            
            rotorRingEls.forEach(el => {
                el.addEventListener('input', function() {
                    this.value = this.value.toUpperCase().replace(/[^A-Z]/g, '');
                });
            });
            
            // Validate plugboard inputs
            plugboardInputs.forEach(el => {
                el.addEventListener('input', function() {
                    this.value = this.value.toUpperCase().replace(/[^A-Z]/g, '');
                });
            });
            
            function getCurrentSettings() {
                const rotorTypes = [
                    parseInt(rotorTypeEls[0].value.charAt(rotorTypeEls[0].value.length - 2)) - 1,
                    parseInt(rotorTypeEls[1].value.charAt(rotorTypeEls[1].value.length - 2)) - 1,
                    parseInt(rotorTypeEls[2].value.charAt(rotorTypeEls[2].value.length - 2)) - 1
                ];
                
                const rotorPositions = [
                    rotorPosEls[0].value || 'A',
                    rotorPosEls[1].value || 'A',
                    rotorPosEls[2].value || 'A'
                ];
                
                const rotorRings = [
                    rotorRingEls[0].value || 'A',
                    rotorRingEls[1].value || 'A',
                    rotorRingEls[2].value || 'A'
                ];
                
                const reflector = reflectorEl.value;
                
                const plugboardPairs = [];
                const pairInputs = document.querySelectorAll('.plugboard-pair');
                pairInputs.forEach(pair => {
                    const inputs = pair.querySelectorAll('input');
                    if (inputs[0].value && inputs[1].value) {
                        plugboardPairs.push([inputs[0].value, inputs[1].value]);
                    }
                });
                
                return {
                    rotorTypes,
                    rotorPositions,
                    rotorRings,
                    reflector,
                    plugboardPairs
                };
            }
            
            function evaluateDecryption(decrypted, knownPlaintext) {
                if (!knownPlaintext) return 0;
                
                const lowerDecrypted = decrypted.toLowerCase();
                const lowerKnown = knownPlaintext.toLowerCase();
                
                // Simple evaluation - count matching consecutive characters
                let bestMatch = 0;
                for (let i = 0; i <= lowerDecrypted.length - lowerKnown.length; i++) {
                    let match = 0;
                    for (let j = 0; j < lowerKnown.length; j++) {
                        if (lowerDecrypted[i + j] === lowerKnown[j]) {
                            match++;
                        }
                    }
                    if (match > bestMatch) {
                        bestMatch = match;
                    }
                }
                
                return (bestMatch / lowerKnown.length) * 100;
            }
            
            function startAttack() {
                if (isRunning) return;
                
                const ciphertext = ciphertextEl.value.toUpperCase().replace(/[^A-Z]/g, '');
                const knownPlaintext = knownPlaintextEl.value.toUpperCase().replace(/[^A-Z]/g, '');
                
                if (!ciphertext) {
                    alert("Please enter ciphertext to decrypt");
                    return;
                }
                
                isRunning = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
                startTime = Date.now();
                configsTested = 0;
                bestScore = 0;
                bestConfig = null;
                bestDecrypted = "";
                
                // Get current settings as starting point
                const settings = getCurrentSettings();
                
                // Calculate total configurations to test
                // This is simplified - in a real attack you'd want to focus on specific parameters
                const totalConfigs = 26 * 26 * 26; // Testing all rotor positions
                totalConfigsEl.textContent = totalConfigs.toLocaleString();
                
                // Clear previous results
                topResultsEl.innerHTML = "";
                decryptedTextEl.textContent = "";
                
                // Start workers
                const numWorkers = parseInt(workersEl.value);
                workers = [];
                
                for (let i = 0; i < numWorkers; i++) {
                    const worker = {
                        id: i,
                        running: true
                    };
                    
                    workers.push(worker);
                    
                    // Simulate worker (in a real app, this would be a Web Worker)
                    setTimeout(() => runWorker(worker, ciphertext, knownPlaintext, settings), 0);
                }
                
                // Start UI updates
                updateInterval = setInterval(updateStats, 100);
            }
            
            function runWorker(worker, ciphertext, knownPlaintext, baseSettings) {
                if (!worker.running) return;
                
                // Simulate testing configurations
                // In a real app, this would be more sophisticated
                const testConfigurations = () => {
                    const batchSize = 100;
                    
                    for (let i = 0; i < batchSize && worker.running; i++) {
                        // Generate a random configuration to test
                        const rotorPositions = [
                            String.fromCharCode(65 + Math.floor(Math.random() * 26)),
                            String.fromCharCode(65 + Math.floor(Math.random() * 26)),
                            String.fromCharCode(65 + Math.floor(Math.random() * 26))
                        ];
                        
                        // Configure the machine
                        enigma.configure(
                            baseSettings.rotorTypes,
                            rotorPositions,
                            baseSettings.rotorRings,
                            baseSettings.reflector,
                            baseSettings.plugboardPairs
                        );
                        
                        // Decrypt the text
                        const decrypted = enigma.decryptString(ciphertext);
                        
                        // Evaluate the result
                        const score = evaluateDecryption(decrypted, knownPlaintext);
                        
                        // Update stats
                        configsTested++;
                        
                        // Check if this is the best result so far
                        if (score > bestScore) {
                            bestScore = score;
                            bestConfig = {
                                rotorTypes: [...baseSettings.rotorTypes],
                                rotorPositions: [...rotorPositions],
                                rotorRings: [...baseSettings.rotorRings],
                                reflector: baseSettings.reflector,
                                plugboardPairs: [...baseSettings.plugboardPairs]
                            };
                            bestDecrypted = decrypted;
                            
                            // Update UI with the new best result
                            updateBestResult();
                        }
                    }
                    
                    if (worker.running) {
                        setTimeout(testConfigurations, 0);
                    }
                };
                
                testConfigurations();
            }
            
            function stopAttack() {
                if (!isRunning) return;
                
                isRunning = false;
                startBtn.disabled = false;
                stopBtn.disabled = true;
                
                // Stop all workers
                workers.forEach(worker => {
                    worker.running = false;
                });
                
                // Stop UI updates
                clearInterval(updateInterval);
            }
            
            function updateStats() {
                const elapsed = (Date.now() - startTime) / 1000;
                elapsedEl.textContent = elapsed.toFixed(1) + "s";
                
                configsTestedEl.textContent = configsTested.toLocaleString();
                
                const configsPerSec = configsTested / elapsed;
                configsPerSecEl.textContent = configsPerSec.toFixed(0);
                
                const totalConfigs = parseInt(totalConfigsEl.textContent.replace(/,/g, ''));
                const completion = totalConfigs > 0 ? (configsTested / totalConfigs) * 100 : 0;
                completionEl.textContent = completion.toFixed(2) + "%";
                
                progressBarEl.style.width = Math.min(100, completion) + "%";
                
                bestScoreEl.textContent = bestScore.toFixed(2);
            }
            
            function updateBestResult() {
                // Update decrypted text
                decryptedTextEl.textContent = bestDecrypted;
                
                // Add to top results
                const resultDiv = document.createElement('div');
                resultDiv.innerHTML = `
                    <strong>Score: ${bestScore.toFixed(2)}</strong><br>
                    Rotors: ${bestConfig.rotorTypes.map(t => t + 1).join(', ')}<br>
                    Positions: ${bestConfig.rotorPositions.join(', ')}<br>
                    Rings: ${bestConfig.rotorRings.join(', ')}<br>
                    Reflector: ${bestConfig.reflector}<br>
                    Plugboard: ${bestConfig.plugboardPairs.map(p => p.join('')).join(' ')}
                `;
                
                topResultsEl.insertBefore(resultDiv, topResultsEl.firstChild);
                
                // Limit to 10 results
                if (topResultsEl.children.length > 10) {
                    topResultsEl.removeChild(topResultsEl.lastChild);
                }
            }
            
            function randomizeSettings() {
                // Random rotor types (ensure all different)
                const rotorTypes = [0, 1, 2, 3, 4];
                shuffleArray(rotorTypes);
                
                rotorTypeEls[0].value = `I (${enigma.rotors[rotorTypes[0]].wiring})`;
                rotorTypeEls[1].value = `II (${enigma.rotors[rotorTypes[1]].wiring})`;
                rotorTypeEls[2].value = `III (${enigma.rotors[rotorTypes[2]].wiring})`;
                
                // Random positions
                rotorPosEls[0].value = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                rotorPosEls[1].value = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                rotorPosEls[2].value = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                
                // Random rings
                rotorRingEls[0].value = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                rotorRingEls[1].value = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                rotorRingEls[2].value = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                
                // Random reflector
                reflectorEl.value = Math.random() < 0.5 ? "B" : "C";
                
                // Random plugboard (up to 10 pairs)
                const plugboardPairs = [];
                const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('');
                shuffleArray(letters);
                
                const numPairs = Math.floor(Math.random() * 11);
                for (let i = 0; i < numPairs * 2; i += 2) {
                    plugboardPairs.push([letters[i], letters[i+1]]);
                }
                
                // Update plugboard UI
                const plugboardContainer = document.querySelector('.plugboard-pairs');
                plugboardContainer.innerHTML = '';
                
                for (let i = 0; i < 10; i++) {
                    const pairDiv = document.createElement('div');
                    pairDiv.className = 'plugboard-pair';
                    
                    const input1 = document.createElement('input');
                    input1.type = 'text';
                    input1.className = 'plugboard-input';
                    input1.maxLength = 1;
                    
                    const input2 = document.createElement('input');
                    input2.type = 'text';
                    input2.className = 'plugboard-input';
                    input2.maxLength = 1;
                    
                    if (i < plugboardPairs.length) {
                        input1.value = plugboardPairs[i][0];
                        input2.value = plugboardPairs[i][1];
                    }
                    
                    pairDiv.appendChild(input1);
                    pairDiv.appendChild(document.createTextNode(' ↔ '));
                    pairDiv.appendChild(input2);
                    plugboardContainer.appendChild(pairDiv);
                }
            }
            
            function resetSettings() {
                // Reset to default settings
                rotorTypeEls[0].value = "I (EKMFLGDQVZNTOWYHXUSPAIBRCJ)";
                rotorTypeEls[1].value = "II (AJDKSIRUXBLHWTMCQGZNPYFVOE)";
                rotorTypeEls[2].value = "III (BDFHJLCPRTXVZNYEIWGAKMUSQO)";
                
                rotorPosEls[0].value = "A";
                rotorPosEls[1].value = "A";
                rotorPosEls[2].value = "A";
                
                rotorRingEls[0].value = "A";
                rotorRingEls[1].value = "A";
                rotorRingEls[2].value = "A";
                
                reflectorEl.value = "B";
                
                // Clear plugboard
                const inputs = document.querySelectorAll('.plugboard-input');
                inputs.forEach(input => {
                    input.value = "";
                });
            }
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            // Initialize
            resetSettings();
        });
    </script>
</body>
                  </html>
